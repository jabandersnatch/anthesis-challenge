<div class="emissions-list-container">
  <!-- Header -->
  <div class="list-header">
    <h1>Emissions Data</h1>
    <div class="header-actions">
      <button mat-stroked-button (click)="toggleFilters()">
        <mat-icon>{{ showFilters() ? 'filter_list_off' : 'filter_list' }}</mat-icon>
        {{ showFilters() ? 'Hide' : 'Show' }} Filters
      </button>
      <button mat-raised-button color="primary" (click)="createNew()">
        <mat-icon>add</mat-icon>
        Add New
      </button>
    </div>
  </div>

  <!-- Filter Panel -->
  @if (showFilters()) {
    <app-filter-panel />
  }

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-spinner">
      <mat-spinner></mat-spinner>
      <p>Loading emissions...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        <h3>Error Loading Data</h3>
        <p>{{ error()?.message }}</p>
      </mat-card-content>
    </mat-card>
  }

  <!-- Emissions Table -->
  @if (!loading() && !error()) {
    <mat-card class="table-card">
      <mat-card-content>
        <!-- Results Count -->
        <div class="results-info">
          <p>
            Showing {{ emissions().length }} of {{ totalCount() }} records
          </p>
        </div>

        <!-- Table -->
        @if (emissions().length > 0) {
          <div class="table-container">
            <table
              mat-table
              [dataSource]="emissions()"
              matSort
              (matSortChange)="onSort($event)"
              class="emissions-table"
            >
              <!-- Year Column -->
              <ng-container matColumnDef="year">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Year</th>
                <td mat-cell *matCellDef="let emission">{{ emission.year }}</td>
              </ng-container>

              <!-- Country Column -->
              <ng-container matColumnDef="country">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Country</th>
                <td mat-cell *matCellDef="let emission">
                  <span class="country-code">{{ emission.country }}</span>
                </td>
              </ng-container>

              <!-- Emissions Column -->
              <ng-container matColumnDef="emissions">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Emissions (Mt COâ‚‚e)</th>
                <td mat-cell *matCellDef="let emission">
                  <span class="emissions-value">{{ emission.emissions | number: '1.2-2' }}</span>
                </td>
              </ng-container>

              <!-- Emission Type Column -->
              <ng-container matColumnDef="emission_type">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
                <td mat-cell *matCellDef="let emission">
                  <mat-chip [class]="'chip-' + emission.emission_type.toLowerCase()">
                    {{ emission.emission_type }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Activity Column -->
              <ng-container matColumnDef="activity">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Activity</th>
                <td mat-cell *matCellDef="let emission">
                  <span class="activity-label">{{ emission.activity }}</span>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let emission">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="editEmission(emission)"
                    matTooltip="Edit"
                  >
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="deleteEmission(emission)"
                    matTooltip="Delete"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns" class="table-row"></tr>
            </table>
          </div>

          <!-- Paginator -->
          <mat-paginator
            [length]="totalCount()"
            [pageSize]="pageSize()"
            [pageIndex]="currentPage() - 1"
            [pageSizeOptions]="[25, 50, 100]"
            (page)="onPageChange($event)"
            showFirstLastButtons
          >
          </mat-paginator>
        } @else {
          <div class="empty-state">
            <mat-icon>inbox</mat-icon>
            <h3>No emissions found</h3>
            <p>Try adjusting your filters or add a new emission record</p>
            <button mat-raised-button color="primary" (click)="createNew()">
              <mat-icon>add</mat-icon>
              Add First Emission
            </button>
          </div>
        }
      </mat-card-content>
    </mat-card>
  }
</div>
